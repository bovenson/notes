[toc]

# Description

RocksDB是一个应用于快速存储环境的持久化kv存储。最初在Facebook作为存储引擎来处理各种存储介质上的服务器工作负载。RocksDB是一个c++库，用于存储键值对，两者都是任意大小的字节流，支持点查询和范围扫描，提供不同类型的ACID保证。

RocksDB具有高度灵活的配置设置，可以被调整为适合多种生产环境，包括纯内存、闪存、硬盘、远程存储，支持多种压缩算法。

RocksDB借鉴了leveldb的核心代码以及Apache HBase的一些构想。

# Feature

## **高性能**

使用完全由C++编写的结构化日志数据库引擎，键值对是任意大小的字节流。可通过配置支持高随机读、高写入/更新、或者两者兼有的场景。RocksDB的架构支持方便地调整针对不同硬件和工作负载的平衡方案。

## **针对快速存储优化**

针对快速、低延迟存储优化。

## **适用性强**

可用于多种数据需求。

## **支持基础、高级数据库选项**

## **列族**

RocksDB支持将数据库实例划分为多个列族，如果没有指定列族，将使用默认的列族名字`default`。

## 操作

### 更新

**Put**

向数据库中插入单个k-v，如果key已经存在，旧的数据会被重写。

**Write**

允许多个k-v自动地插入、更新、删除，RocksDB保证一次Write操作中的所有的k-v要么全被插入，要么没有一个被插入数据库中，如果key存在，数据会被覆盖。

**Range Delete**

用于所有指定范围的所有key。

### 查询

键和值被是没有大小限制的字节流。

**Get**

查询单个key。

**MultiGet**

允许应用程序从数据库中检索一堆key。

### 遍历

数据库中所有数据均按排序顺序进行逻辑排序，应用程序可以指定key的排序方法，指定key的排序方式。

**Iterator**

Iterator允许应用程序对数据库做RangeScan操作，迭代器可以查询指定key，应用程序可以从改点一次扫描一个key。Iterator也可用于反向遍历。创建Iterator时，将创建数据库的一致时间点视图。因此，通过Iterator返回的所有键都是从数据库的一致视图中获得的。

**快照**

Snapshot API允许应用程序创建数据库的时间点视图。Get和Iterator API可用于从指定的快照读取数据。从某种意义上说，快照和迭代器都提供了数据库的时间点视图，但是它们的实现是不同的。短期/向前扫描最好通过迭代器完成，而长时间运行/向后扫描最好通过快照完成。迭代器会在与数据库的该时间点相对应的所有基础文件上保留引用计数-在释放迭代器之前，不会删除这些文件。快照并不能防止文件删除，压缩进程知道快照的存在，并承诺不会删除任何现有快照中可见的密钥。

快照在数据库重新启动后不会持久保存：重新加载RocksDB库（通过服务器重新启动）会释放所有先前存在的快照。

# High Level Architecture

RocksDB是kv存储接口的底层存储引擎库，对应的kv都是任意大小的字节流。RocksDB以有序的方式组织所有数据，通用操作有`Get(key)`，`NewIterator()`，`Put(key, val)`，`Delete(key)`，`SingleDelete(key)`。

RocksDB三个基本组件是 memtable、sstfile、logfile。memtable是内存中的数据结构，新写入的数据被塞入memtable，也可以选择同时写入logfile。logfile是存储中基于序列化写入的文件。memtable填满后，将刷新到存储中的sstfile中，对应的logfile也会被安全地删除。sstfile中的数据是经过排序的，以方便快速查找key。